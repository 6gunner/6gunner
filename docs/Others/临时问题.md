

q1: 咱们的legend game部署在opBNB上，那么opBNB是什么样性质的一个网络呢？

类似的，Mantle网络是什么性质的？



Q2: 页面上有很多modulepreload类型的link，这些有啥作用?

`<link rel="modulepreload" href="modules/xxx.js" />` 作用类似于

`<link rel="preload" href="xxx"/> `

都是提前加载资源的。区别在于，preload只是会加载js文件，并且将他存储在缓存里，但是modulepreload除了加载之外，还会解析js，编译模块，然后放在module map里，随时准备执行。



对比一下



不用modulepreload

```html
<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="user-scalable=no">
<meta name="viewport" content="initial-scale=1,maximum-scale=1">

<head>
  <meta charset="utf-8">
  <title>Basic JavaScript module example</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
  <!-- <link rel="modulepreload" href="static/modulepreload/main.js" />
  <link rel="modulepreload" href="static/modulepreload/modules/canvas.js" />
  <link rel="modulepreload" href="static/modulepreload/modules/square.js" /> -->

</head>

<body>
  <div id="app"></div>
  <script type="module" src="static/modulepreload/main.js"></script>

</body>

</html>
```

截图1：

可以看到canvas和square两个模块是main.js解析后才加载的

![image-20231114173301446](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-14/image-20231114173301446.png)



改成modulepreload

按下面这种带预加载的代码来，

```html
<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="user-scalable=no">
<meta name="viewport" content="initial-scale=1,maximum-scale=1">

<head>
  <meta charset="utf-8">
  <title>Basic JavaScript module example</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
  <link rel="modulepreload" href="static/modulepreload/main.js" as="script" />
  <link rel="modulepreload" href="static/modulepreload/modules/canvas.js" />
  <link rel="modulepreload" href="static/modulepreload/modules/square.js" />

</head>

<body>
  <div id="app"></div>
  <script type="module" src="static/modulepreload/main.js"></script>

</body>

</html>
```

截图2：

![image-20231114222051789](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-14/image-20231114222051789.png)

可以看到js是提前加载，并且module是编译、解析了的（最后一个call tree是cache module）



加入我注释掉下面的这行代码，

```html
  <!-- <script type="module" src="static/modulepreload/main.js"></script> -->
```

我们的js也还是进行加载，不过没有Evulate Module；

>备注：执行的是Compile Module，但是没有Evulate Module，Compile Code。
>
>1. Compile Module: 这个阶段浏览器会将 JavaScript 源代码编译成字节码（或者有时候是优化后的机器代码，取决于 JavaScript 引擎的优化策略和代码的具体执行情况）。编译过程包括解析（将源代码转换为抽象语法树）和生成字节码。
>
>2. Evaluate Module: 在这个阶段，浏览器会处理 JavaScript 模块的所有导入（import）和导出（export）声明，链接模块及其依赖项，然后执行模块代码。这包括把模块中导入的其他模块全部加载完毕，并处理好这些模块之间的依赖关系，然后才会执行这个模块的代码。实际上，Evaluate Module 阶段就是执行编译后的字节码。

截图如下：

![image-20231114221452989](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-14/image-20231114221452989.png)



最后

将modulepreload改成preload，可以看见js虽然加载了，但是没有被解析编译，因此上面的说法得以证明。

![image-20231114220533262](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-14/image-20231114220533262.png)





q3:全局事件是干嘛的？钱包的事件么？

user_switch_event

这个是系统里自己定义的全局事件，在登录完成以后，触发的

```html

  window.dispatchEvent(new Event(user_switch_event));

```





Q4: 看到的代码优化的地方

bridge里用的ctx会重复创建，导致每次都重新监听user_switch_event





Q5： 他这里封装请求的地方,leading是什么意思？，trailing是什么意思？

```json
import { default as debounceFn } from "lodash.debounce";

type Option = {
  debounce?: {
    wait: number;
    leading?: boolean; // 第一次触发
    trailing?: boolean; // delay触发
  };
  //处理竞态的情况.一定会取消上一个（包括第一个）请求
  race?: boolean;
};

const fetch = useMemo(() => {
    if (debounce) {
      return debounceFn(_fetch, debounce.wait, {
        leading: debounce.leading ?? false, // 默认false，第一次不触发
        trailing: debounce.trailing ?? true, // delay触发
      });
    }
    return _fetch;
  }, [_fetch, debounce]);
```



Q6: typescript 这个`??`是什么东西？

答：?? 空值合并运算符，和||一样，但是比||好，因为遇到falsy值时，只有真的是null时，才会去取右边的值





Q7: immer这个state保存工具再做什么? produce这个api在干嘛？

回答：produce是immer的核心方法，可以帮我们实现redux里的纯函数的写法。看起来我们直接修改状态了，但是实际上produce里面是重新创建了一个新的对象；

```ts
import { produce } from 'immer';


export const useGlobalStore = create<GlobalStore>(set => ({
  state: defaultStates,
  action: {
    update: payload => {
      // 去覆盖store
      set(
        produce(store => {
          return {
            ...store,
            state: { ...store.state, ...payload },
          };
        })
      );
    },
  },
}));

```





Q8: 这段正则在干嘛？![image-20231115135023730](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-15/image-20231115135023730.png)





Q9: 优化active的样式



图片有拉伸, 设置了最小高度，默认auto的

![image-20231116105845889](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-16/image-20231116105845889.png)



这个是svg，显示器的问题；

![image-20231116110231405](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-16/image-20231116110231405.png)



这个有一次抖动

![image-20231115210447446](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-15/image-20231115210447446.png)





![image-20231115212133227](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-15/image-20231115212133227.png)





Q11: ![image-20231116102110112](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-16/image-20231116102110112.png)



BUG: 钱包余额资产没有实时的去监听

![image-20231116144809271](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2023/11-16/image-20231116144809271.png)
