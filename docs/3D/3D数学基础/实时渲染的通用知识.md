
### cpu需要提供给gpu哪些数据？
最基础的是一个3d模型，包括（顶点坐标+坐标轴）=>三角切面=> 
ps: 为啥是三角切面？绘制三角形，虽然立方体是正方形，但是gpu的处理是将3个顶点链接成三角形来处理的

再是摄像机视角信息，包括什么 Field of vision, 坐标等
再可能需要平行光源的信息
最后需要着色器，shader；

### gpu接收到cpu命令后的流程：

我们交渲染piepline, 理解为渲染的基本流程，包括了Vertex Shader,  Triangler Processor,  Rasterization, 

Vertex Shader：顶点着色。会结合三角形的坐标，摄像机等信息，将我们的坐标点进行各种转化；。。

Triangler Processor： todo

Rasterization： 光栅化，因为我们的屏幕是一个个的像素点组成，所以这里就是将我们的三角面渲染出来；

Pixel Shader: 对每一个像素着色；






**问题**：抗锯齿是干嘛的？比如三角形，有一些像素里是一半有颜色，另一半没颜色，抗锯齿是针对这些像素处理这块的么？








### 怎么从一个模型空间，转化到clip coordinate？

#### 从模型空间到裁剪空间的公式  MVP

在 WebGL 或 OpenGL 中，顶点的裁剪空间坐标（clip coordinates）由以下公式计算：

$$
clip_position=uProjectionMatrix \times uViewMatrix \times uModelMatrix \times \text{vertex\_position}
$$
- **`vertex_position`**：顶点在模型空间的坐标，通常是 `(x, y, z, 1)`（4D 齐次坐标）。
- **`uModelMatrix`**：模型矩阵，用于将顶点从模型空间转换到世界空间。它表示物体的平移、旋转和缩放。
- **`uViewMatrix`**：视图矩阵，用于将顶点从世界空间转换到视图空间。它表示相机的视角。 理解为相机的左移动，右移动；
- **`uProjectionMatrix`**：投影矩阵，用于将顶点从视图空间转换到裁剪空间。它决定了物体的透视投影或正交投影。



#### 变换过程的分解

#### a) **模型空间到世界空间**

用模型矩阵 uModelMatrixu 变换：
$$
world\_position=uModelMatrix×vertex\_position
$$


将顶点从局部坐标系（模型空间）变换到世界坐标系。

#### b) **世界空间到视图空间**

用视图矩阵 uViewMatrix变换：
$$
view\_position =uViewMatrix\times world\_position
$$


将顶点从世界坐标系变换到视图坐标系（相机坐标系）。

#### c) **视图空间到裁剪空间**

用投影矩阵 uProjectionMatrix变换：
$$
clip\_position=uProjectionMatrix\times view\_position
$$


将顶点从视图坐标系变换到裁剪空间。这一步会引入投影效果（如透视投影），并对 x, y, z 的范围进行规范化。



####  **裁剪空间的范围**



### 怎么理解这个投影矩阵？ 

将我们世间空间的坐标转化到clip坐标上



相机的视图矩阵就是一个视椎体；

 

有一个近裁剪面，一个远裁剪面；

FOV指的是视椎体的角度，在3D空间需要两个角度：水平视野，垂直视野；
ZOOM指的是对象的Apparent大小相对于90度角的比例

#### 透视投影和正交投影

正交投影没有视角的概念，视椎体相当于一个盒子模型，网格的大小始终相同，网格线保持平行；

透视投影有视角的概念，有近clip面，远clip面。 近的网格大小比远的大；

#### 正交投影 （Orthography）

![image-20241118215332688](https://ipic-coda.oss-cn-beijing.aliyuncs.com/2024/11-18/image-20241118215332688.png)





#### 透视投影 ()







### 坐标空间

模型投影到屏幕空间，会经过：对象空间=>世界空间=>相机空间=>剪裁空间=>投影到屏幕 4个步骤的转化。

**对象空间**，也成为local坐标，可以经过modal transform转化矩阵，变成世界空间的坐标。 一般光照的位置是描述在世界空间World Space的。



**世界空间**

世界空间中，顶点可以通过view transform，变化成相机空间。



**相机空间** Camera Space

原点位于投影的中心，有3个



**剪裁空间 Clip Space**

在相机空间里，通过剪裁矩阵，可以将顶点转化为剪裁空间(又称为规则观察体空间)



**剪裁矩阵的功能：**

1. 准备投影

**正交投影：最右侧总是**
$$
\begin{bmatrix} 
0 & 0 & 0 & 1
\end{bmatrix}^T 
$$

$$
\begin{bmatrix} 
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
\end{bmatrix}
$$

[x y z 1]乘以它，等于[x y z 1], 投影除以1，等于[x y z]



**透视投影：最右侧总是**


$$
\begin{bmatrix} 
0 & 0 & 1 & 0
\end{bmatrix}^T
$$
[x y z 1]乘以它，等于[x y z z], 投影除以z，等于[x/z y/z 1]
$$

$$


2、应用缩放并准备剪裁

